var p = Object.defineProperty;
var h = (s, e, t) => e in s ? p(s, e, { enumerable: !0, configurable: !0, writable: !0, value: t }) : s[e] = t;
var a = (s, e, t) => (h(s, typeof e != "symbol" ? e + "" : e, t), t);
import { define as d, Component as m, h as o } from "omi";
var l;
d(
  "o-suspense",
  (l = class extends m {
    constructor() {
      super(...arguments);
      a(this, "state", "pending");
      a(this, "timeout", null);
    }
    install() {
      this.handleTasks(this.props.imports);
    }
    receiveProps() {
      this.state = "pending", this.handleTasks(this.props.imports);
    }
    async handleTasks(e) {
      this.timeout !== null && clearTimeout(this.timeout);
      let t = Date.now();
      const n = [...e];
      if (this.props.data && n.push(this.props.data()), n.length === 0)
        this.state = "pending";
      else {
        this.fire("pending");
        try {
          const i = await Promise.all(n);
          let r = Date.now() - t;
          r < this.props.minLoadingTime ? this.timeout = setTimeout(() => {
            this.state = "resolve", this.fire("resolve"), this.fire("data-loaded", i.pop()), this.update();
          }, this.props.minLoadingTime - r) : (this.state = "resolve", this.fire("resolve"), this.fire("data-loaded", i.pop()));
        } catch (i) {
          console.error(i), this.state = "fallback", this.fire("fallback");
        }
      }
      this.update();
    }
    render() {
      return this.state === "pending" ? /* @__PURE__ */ o("slot", { name: "pending" }) : this.state === "resolve" ? /* @__PURE__ */ o("slot", null) : /* @__PURE__ */ o("slot", { name: "fallback" });
    }
  }, a(l, "defaultProps", {
    imports: [],
    data: null,
    minLoadingTime: 0
  }), l)
);
